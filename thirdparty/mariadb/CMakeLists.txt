set(WITH_MARIADB "BUNDLED" CACHE STRING "MariaDB mode: OFF, SYSTEM, BUNDLED")

if (NOT WITH_MARIADB STREQUAL "OFF")
	if (WITH_MARIADB STREQUAL "SYSTEM")
		list(APPEND CMAKE_MODULE_PATH "${CMAKE_CURRENT_LIST_DIR}/cmake")
		message(STATUS "CMAKE_MODULE_PATH=${CMAKE_MODULE_PATH}")
		find_package(MariaDBConnector REQUIRED)
	else()
		set(WITH_MYSQLCOMPAT OFF CACHE STRING "Enable MySQL compatibility mode (requires MariaDB Connector-C)")
		set(WITH_UNIT_TESTS OFF CACHE STRING "Disable building MariaDB Connector-C unit tests")
		set(ZLIB_BUILD_EXAMPLES OFF CACHE STRING "Disable building zlib examples")
		set(INSTALL_PLUGINDIR "lib/mariadb/plugins" CACHE PATH "MariaDB connector plugin install directory")
		if (WIN32)
			set(WITH_SSL SCHANNEL CACHE STRING "Enable SSL support in MariaDB Connector-C (options: OFF, OPENSSL, SCHANNEL)")
		endif()
		add_subdirectory(mariadb-connector-c)
		add_library(MariaDB::ConnectorC ALIAS libmariadb)
	endif()

	cmake_policy(SET CMP0079 NEW)
	target_link_libraries(StormByte-Database PRIVATE MariaDB::ConnectorC)
endif()